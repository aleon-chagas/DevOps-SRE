[defaults]

# --- General settings ---
# Número de processos paralelos. 50 é alto; 10-25 é comum para clusters de 4 VMs.
forks                   = 10
log_path                = ./ansible.log
# Usar o shell nativo da máquina remota (/bin/sh ou /bin/bash) é a melhor prática.
#executable              = /bin/bash
# Aumentar o timeout de conexão, especialmente para cloud.
timeout                 = 30
# Desabilita a verificação da chave do host para evitar falha na primeira conexão AWS.
# IMPORTANTE: AVISO DE SEGURANÇA - Veja a seção abaixo.
host_key_checking       = False
# Usa Jinja2 nativo para melhor manipulação de strings (boas práticas).
jinja2_native           = True
module_name             = ping
executable              = /bin/bash

# --- Files/Directory settings ---
inventory               = ./deploy/env/aws
library                 = ./library
roles_path              = ./deploy/roles
remote_tmp              = /tmp
local_tmp               = ~/.ansible/tmp

# Suprimir warnings comuns
deprecation_warnings    = False
command_warnings        = False

# --- Users settings ---
remote_user             = ubuntu
# O Ansible vai usar o 'remote_user' para se conectar.
# A senha é desnecessária se você usa chaves SSH/IAM Role.
# ask_pass              = False

# --- Python interpreter ---
interpreter_python      = /usr/bin/python3

#--- SSH settings
private_key_file        = ~/.ssh/ssh_keys/courses/devops2025.pem

[privilege_escalation]

become                  = True
become_method           = sudo
become_user             = root
# NUNCA peça senha para elevação em automação (use o SSH sem senha).
become_ask_pass         = False

[ssh_connection]

# --- Performance and Reliability ---
# Reúsa conexões SSH existentes para acelerar execuções de playbooks.
pipelining              = True
# Desativa scp (usando sftp/pipelining) se necessário. 'smart' é o padrão.
scp_if_ssh              = smart
# Usar 'smart' para método de transferência é a melhor prática.
transfer_method         = smart
retries                 = 3

# Se você está usando o '-F ./ssh.config' na linha de comando, remova-o.
# Se for incluído, ele anulará muitas configurações padrão do Ansible.
# O Ansible se integra melhor com o ~/.ssh/config.
ssh_args=-o ControlPath=/tmp/cm-%r@%h:%p -o ControlMaster=auto -o ControlPersist=60s -F ./ssh.config